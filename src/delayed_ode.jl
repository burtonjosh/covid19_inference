function delayed_ode(du,u,p,t)
  rates, probabilities, transmission_rates = p
  du[1]  = -u[1] * transmission_rates[1] * ( transmission_rates[2]*(u[2]+u[3]+u[4]+u[13]+u[14]+u[15]+u[16]) + (u[5]+u[6]+u[7]) ) / u[20]
  du[2]  = (1-probabilities[1]) * u[1] * transmission_rates[1] * ( transmission_rates[2]*(u[2]+u[3]+u[4]+u[13]+u[14]+u[15]+u[16]) + (u[5]+u[6]+u[7]) ) / u[20] - rates[1]*u[2]
  du[3]  = rates[1]*u[2] - rates[1]*u[3]
  du[4]  = rates[1]*u[3] - rates[1]*u[4]
  du[5]  = probabilities[2]*rates[1]*u[4] - rates[2]*u[5]
  du[6]  = rates[2]*u[5] - rates[2]*u[6]
  du[7]  = (1-probabilities[2])*rates[1]*u[4] - rates[3]*u[7]
  du[8]  = probabilities[3]*rates[2]*u[6] - rates[4]*u[8]
  du[9]  = (1-probabilities[3]-probabilities[5])*rates[2]*u[6] - rates[5]*u[9]
  du[10] = probabilities[4]*rates[4]*u[8] - rates[6]*u[10]
  du[11] = (1-probabilities[4])*rates[4]*u[8] - rates[7]*u[11]
  du[12] = rates[7]*u[11] - rates[8]*u[12]
  du[13] = probabilities[1] * u[1] * transmission_rates[1] * ( transmission_rates[2]*(u[2]+u[3]+u[4]+u[13]+u[14]+u[15]+u[16]) + (u[5]+u[6]+u[7]) ) / u[20] - rates[1]*u[13]
  du[14] = rates[1]*u[13] - rates[1]*u[14]
  du[15] = rates[1]*u[14] - rates[1]*u[15]
  du[16] = rates[1]*u[15] - rates[9]*u[16]
  du[17] = rates[3]*u[7] + rates[5]*u[9] + rates[6]*u[10] + rates[9]*u[16]
  du[18] = rates[6]*u[10] + rates[5]*u[21] - rates[10]*u[18]
  du[19] = rates[10]*u[18]
  du[20] = -rates[6]*u[10] - rates[5]*u[21]
  du[21] = probabilities[5]*rates[2]*u[6] - rates[5]*u[21]
end
